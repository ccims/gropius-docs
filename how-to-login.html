<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-docs/how-to-login">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">How-To Login-Service (or rather Hot-To use the Gropius Backend at all) | Gropius</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ccims.github.io/gropius-docs/how-to-login"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="How-To Login-Service (or rather Hot-To use the Gropius Backend at all) | Gropius"><meta data-rh="true" name="description" content="This How-To will the essential steps to get a Gropius installation going including a fully functional login-service. It will use the testing docker-compose file, as the development docker-compose file uses the dev login service which is intended to easily provide access tokens but does not include the full login service functionality."><meta data-rh="true" property="og:description" content="This How-To will the essential steps to get a Gropius installation going including a fully functional login-service. It will use the testing docker-compose file, as the development docker-compose file uses the dev login service which is intended to easily provide access tokens but does not include the full login service functionality."><link data-rh="true" rel="icon" href="/gropius-docs/img/logo.svg"><link data-rh="true" rel="canonical" href="https://ccims.github.io/gropius-docs/how-to-login"><link data-rh="true" rel="alternate" href="https://ccims.github.io/gropius-docs/how-to-login" hreflang="en"><link data-rh="true" rel="alternate" href="https://ccims.github.io/gropius-docs/how-to-login" hreflang="x-default"><link rel="stylesheet" href="/gropius-docs/assets/css/styles.4fb28803.css">
<link rel="preload" href="/gropius-docs/assets/js/runtime~main.eaca41a1.js" as="script">
<link rel="preload" href="/gropius-docs/assets/js/main.109f328f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gropius-docs/"><div class="navbar__logo"><img src="/gropius-docs/img/logo.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/gropius-docs/img/logo.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Gropius Backend</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gropius-docs/">Docs</a><a class="navbar__item navbar__link" href="/gropius-docs/api/core">API</a><a class="navbar__item navbar__link" href="/gropius-docs/graphql/api-public">GraphQL</a><a class="navbar__item navbar__link" href="/gropius-docs/rest/login-service/gropius-login-service">REST</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ccims" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gropius-docs/">Gropius Backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gropius-docs/modules">Modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gropius-docs/github-sync">GitHub sync</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gropius-docs/jira-sync">Jira sync</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gropius-docs/login">Login Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/gropius-docs/how-to-login">How-To Login-Service (or rather Hot-To use the Gropius Backend at all)</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/gropius-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How-To Login-Service (or rather Hot-To use the Gropius Backend at all)</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>How-To Login-Service (or rather Hot-To use the Gropius Backend at all)</h1><p>This How-To will the essential steps to get a Gropius installation going including a fully functional login-service. It will use the testing docker-compose file, as the development docker-compose file uses the dev login service which is intended to easily provide access tokens but does not include the full login service functionality.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Some steps taken in this how to might however NOT be appropriate for a production setup!</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr-steps-summary-see-below-for-details">Tldr (Steps-Summary; see below for details)<a href="#tldr-steps-summary-see-below-for-details" class="hash-link" aria-label="Direct link to Tldr (Steps-Summary; see below for details)" title="Direct link to Tldr (Steps-Summary; see below for details)">​</a></h2><ol><li>Clone the repository</li><li>Configure everything
a. Set the service configurations
b. If desired - create default/initial strategy instance, admin-user, and OAuth client using the config</li><li>Run the services and - if desired - access the <code>/login-debug</code> page</li><li>Get an access token for the default user by logging in using the userpass strategy</li><li>Configure/Create one (or more) OAuth clients with the desired redirect URL and - if desired - client secrets</li><li><a href="https://github.com/settings/applications/new" target="_blank" rel="noopener noreferrer">Create a GitHub OAuth App</a> and retrieve the client id and client secret (<a href="https://developer.atlassian.com/console/myapps/" target="_blank" rel="noopener noreferrer">https://developer.atlassian.com/console/myapps/</a>)</li><li>Create/Configure a github-strategy instance with the client id and secret (enable login, sync and if desired self &amp; implicit registration)</li><li>Run the redirect OAuth flowusing the github-strategy instance and an OAuth client
a. Choose between login(/implicit-register), register or register with sync</li><li>Request an access token after returning from GitHub
a. Will be a registration token if (implicitly or explicitly) registering
b. Will be a full access token if loggin in</li><li>If registering: Link the OAuth authentication to a user
a. Create a new user using the registration token and additional user data
b. Link as new authentication for an existing user using the registration token and an access token for that user</li><li>If registering new: Convert the registration token to a full access token by refreshing it</li><li>Use the graphql API using a full access token retrieved by any means (userpass, github, refreshing, ...)</li><li>If expired or even before expiry: Refresh your access token to get a new one</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cloning">Cloning<a href="#cloning" class="hash-link" aria-label="Direct link to Cloning" title="Direct link to Cloning">​</a></h2><p>To use the Gropius backend, you have to clone all required sources. The easiest way is to use the <a href="https://github.com/ccims/gropius" target="_blank" rel="noopener noreferrer">Gropius</a> repository.
Run the following commands to clone the repository into your current workdir:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone </span><span class="token operator">--</span><span class="token plain">recursive https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">com</span><span class="token operator">/</span><span class="token plain">ccims</span><span class="token operator">/</span><span class="token plain">gropius</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd gropius</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2><p>The login service (as well as most of the Gropius services) is configured using environment variables. These can (depending on the way of deploying) be set in actual the console/system environment, the docker-compose file or an environment file. For a docker-compose based installation, using the docker-compose file is recommended. When deploying (the login-service) outside docker, configure your setup in a <code>gropius-backend/login-service/.env.[dev/prod].local</code> file.
Variables on the environment (either set in the docker-compose file or the console environment will take precedence over variables set in a <code>.env</code> file).</p><p>The following sections will describe the most important config settings needed to get running. Especially a production environment you want to consider all configuration for all services.</p><p>We recommend you perform the configuration changes described in the following in the file <code>docker-compose-testing.yaml</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-token-expiration">Access token expiration<a href="#access-token-expiration" class="hash-link" aria-label="Direct link to Access token expiration" title="Direct link to Access token expiration">​</a></h3><p>The setting <code>GROPIUS_ACCESS_TOKEN_EXPIRATION_TIME_MS</code> takes a number of milliseconds after which issued access tokens (no matter the scope) will expire.
The docker compose file sets this to 10 minutes by default. For development, you might want to consider increasing this time, so you don&#x27;t need to refresh your token every 10 minutes. For a production setup you can still increase this a bit but revoking currently valid access tokens isn&#x27;t trivial.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="initial-user-creation">Initial user creation<a href="#initial-user-creation" class="hash-link" aria-label="Direct link to Initial user creation" title="Direct link to Initial user creation">​</a></h3><p>To be able to interact with the system and access it, you need a user account. You can specify config options that will cause the login service to ensure that the needed entities are present on startup.
You will need to create a strategy instance (specifying the way you will login with the created user), an auth client and the user itself.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>It is recommended, you only specify these configuration options on the initial launch and remove them once the system is set up. You can always add them if you lost access etc.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="strategy-instance-creation">Strategy instance creation<a href="#strategy-instance-creation" class="hash-link" aria-label="Direct link to Strategy instance creation" title="Direct link to Strategy instance creation">​</a></h4><p>Creating an instance of the <code>userpass</code> strategy will be the most useful, as you will then be able to log in using a username and password.
Needed configuration variables:</p><ul><li><code>GROPIUS_DEFAULT_STRATEGY_INSTANCE_TYPE</code>: The Strategy to instance. <code>userpass</code> is recommended.</li><li><code>GROPIUS_DEFAULT_STRATEGY_INSTANCE_CONFIG</code>: The configuration for the strategy instance. The userpass strategy does not require any configuration. Set this to <code>{}</code></li><li><code>GROPIUS_DEFAULT_STRATEGY_INSTANCE_NAME</code>: The name for the strategy instance to create. The instance will only be created, if no login strategy instance with this name exists yet. Else creation will be skipped.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="initial-admin-user-creation">Initial admin user creation<a href="#initial-admin-user-creation" class="hash-link" aria-label="Direct link to Initial admin user creation" title="Direct link to Initial admin user creation">​</a></h4><p>You can create a user that you can log in with to access the system.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Any users created using the configuration options will be created as admin users.</p></div></div><p>Needed configuration variables:</p><ul><li><code>GROPIUS_DEFAULT_USER_USERNAME</code>: The username of the new user to create. Must be unique. If a user with the specified username already exists, no new user will be created.</li><li><code>GROPIUS_DEFAULT_USER_DISPLAYNAME</code>: The clear text display name of the user to be created.</li><li><code>GROPIUS_DEFAULT_USER_STRATEGY_INSTANCE_NAME</code>: The name of the strategy instance with which to register the new user. This can be the name set in <code>GROPIUS_DEFAULT_STRATEGY_INSTANCE_NAME</code>.</li><li><code>GROPIUS_DEFAULT_USER_POST_DATA</code>: The variables to &quot;send&quot; to the user registration process. The exact structure depends on the chosen strategy instance. For an instance of userpass the post data should look like <code>{&quot;password&quot;: &quot;PASSWORD_OF_THE_NEW_USER&quot;}</code></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="auth-client-creation">Auth client creation<a href="#auth-client-creation" class="hash-link" aria-label="Direct link to Auth client creation" title="Direct link to Auth client creation">​</a></h4><p>As every active login of a user must be bound to an auth client (a software that required the user to authenticate) you need to create one as well.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>The auth client will be created WITHOUT requiring a client secret. This means EVERYBODY who knows the id of the client can simply initiate a user login as this client. It is recommended, you add at least a client secret immediately after setup. Especially if the service is accessible for others.</p></div></div><p>Needed configuration variables:</p><ul><li><code>GROPIUS_DEFAULT_AUTH_CLIENT_NAME</code>: The name of the auth client to create. If an auth client with this name already exists </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="initial-startup">Initial startup<a href="#initial-startup" class="hash-link" aria-label="Direct link to Initial startup" title="Direct link to Initial startup">​</a></h2><p>To start all services (running in testing mode = debugging web interface ports are exposed) run:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker compose </span><span class="token operator">-</span><span class="token plain">f docker</span><span class="token operator">-</span><span class="token plain">compose</span><span class="token operator">-</span><span class="token plain">testing</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">yaml up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>This compose file should not be used in production</p></div></div><p>To verify, that the login-service is running, using a browser access the following URL (replace <code>[HOST_OF_DOCKER_MACHINE]</code> with <code>localhost</code> if you are running the browser on the machine you are executing the docker containers on). You should see the Swagger API documentation for the login service.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">HOST_OF_DOCKER_MACHINE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token operator">:</span><span class="token number">3000</span><span class="token operator">/</span><span class="token plain">login</span><span class="token operator">-</span><span class="token plain">api</span><span class="token operator">-</span><span class="token plain">doc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-login-api">Using the login API<a href="#using-the-login-api" class="hash-link" aria-label="Direct link to Using the login API" title="Direct link to Using the login API">​</a></h2><p>The following section describes the basic functionality of the login API and the steps to take to interact with the backend after the initialization described above.
The login service acts as <a href="https://www.rfc-editor.org/rfc/rfc6749" target="_blank" rel="noopener noreferrer">OAuth2.0 server according to the specification</a> so you can also send requests directly (using e.g. postman).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-debug-page">The debug page<a href="#the-debug-page" class="hash-link" aria-label="Direct link to The debug page" title="Direct link to The debug page">​</a></h2><p>The debug page is deployed at <code>/login-debug</code> and shows all request details for all steps. It was created for more conveniently interacting with the login API without requiring to manually put together http-requests while still showing how the requets are structured.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="functionality">Functionality<a href="#functionality" class="hash-link" aria-label="Direct link to Functionality" title="Direct link to Functionality">​</a></h3><p>The debug page lists the most important queries for interacting with the login service and makes it easy to execute them.
Every request has the following components:</p><ul><li>Headline: Describes what the request does</li><li>Input fields: Prompt for all data required for executing the request (sometimes the headline might contain an input field)</li><li>Request method + URL: The Data from the input fields and settings is assembled into the request URL. The method is shown in front of it.</li><li>Request body (if needed): If the request requires sending data in the body, the body (assembled from the input) is shown below the URL</li><li>&quot;Request&quot;-Button: Sends the request as shown with the method, URL and body and displays the result as specified in the settings.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="settings">Settings<a href="#settings" class="hash-link" aria-label="Direct link to Settings" title="Direct link to Settings">​</a></h3><p>On the top of the debug page, you can set a few preferences. They are saved in your browsers local storage, meaning they will persist across reloads/restarts as long as you don&#x27;t clear it manually or the URL of the page changes.</p><ul><li><code>Gropius system hostname</code>: <ul><li>The URL where the gropius backend (and especially the login-service) is running</li><li>It is automatically populated with the URL you used to access the debug page.</li></ul></li><li><code>Replace filled token fields</code>:<ul><li>If this is checked, the fields for access and refresh token will be overwritten if any requests that returns new tokens is executed</li><li>If not checked, the fields will only be filled if they are empty</li></ul></li><li><code>Access token</code>:<ul><li>This access token will be used for requests that require authentication</li><li>It will initially be empty</li><li>It will be automatically populated if you execute a query returning tokens</li></ul></li><li><code>Output responses to</code>:<ul><li>Sets where the http-response-body of the requests should be output to</li><li>Dev-Console (default): The browser-develomplent console (in most browsers accessed by pressing F12). Recommended as most browsers provide formatting and advanced exploration tools for JSON output</li><li>Popup: On response open a (modal) popup dialog</li><li>Textbox at bottom: Append the result to the textarea at the bottom of the page. Recommended if you don&#x27;t have access to the development console</li><li>Console+Popup: Combination of options &quot;Dev-Console&quot; and &quot;Popup&quot;</li></ul></li></ul><p>The following step-by-step guide will assume you are using the debug page.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="custommanual-requests">Custom/Manual requests<a href="#custommanual-requests" class="hash-link" aria-label="Direct link to Custom/Manual requests" title="Direct link to Custom/Manual requests">​</a></h3><p>The debug page allows sending custom requests with the convenience of automatically completing the URL and adding the credentials.
To use this, the function <code>request(...)</code> is provided in the developent console (F12 in most browsers).</p><p>Method signature: <code>async request(url, method = &quot;GET&quot;, body = undefined, token = this.accessToken)</code></p><p>Example usage to request the registration data suggestion: <code>request(&quot;login/registration/data-suggestion&quot;, &quot;POST&quot;, 
{&quot;register_token&quot;: &quot;token&quot;})</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="retrieving-an-access-token-using-the-userpass-strategy">Retrieving an access token using the <code>userpass</code> strategy<a href="#retrieving-an-access-token-using-the-userpass-strategy" class="hash-link" aria-label="Direct link to retrieving-an-access-token-using-the-userpass-strategy" title="Direct link to retrieving-an-access-token-using-the-userpass-strategy">​</a></h2><p>Once initialized with a default admin user as described above, you likely want to log in and retrieve a token for this user.</p><ol><li>Show all existing userpass strategy instances<ul><li>Every set of credentials is bound to one specific strategy instance</li><li>To log in using a strategy instance, you neet its id</li><li>If you followed the setup above, one userpass instance should have been created</li></ul></li><li>Log in using username and password<ul><li>The ID of the userpass instance was autofilled from the previuos step</li><li>Fill in username and password that you specified in the configuration</li></ul></li><li>Access and refresh token<ul><li>The fields for access and refresh token should now be filled</li><li>If you ran the requests manually, make sure to save both tokens as the access token will expire after the set period of time and you will neet to refresh it</li></ul></li></ol><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>If you are in a production environment or set <code>GROPIUS_ALLOW_PASSWORD_TOKEN_MODE_WITHOUT_OAUTH_CLIENT=false</code>, then you need to authenticate with an OAuth client for <strong>every</strong> request involving access tokens. See &quot;OAuth clients&quot; below.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="refresh-token">Refresh token<a href="#refresh-token" class="hash-link" aria-label="Direct link to Refresh token" title="Direct link to Refresh token">​</a></h3><ul><li>If you request a token refresh, your old access AND refresh token will become invalid.</li><li>The access and refresh token fields on the debg page will automatically be filled with the new tokens (idependant of the settings)</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>If a refresh token is used twice, the whole chain of tokens including the valid ones will be inalidated for security reasons.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="registering-using-userpass">Registering using <code>userpass</code><a href="#registering-using-userpass" class="hash-link" aria-label="Direct link to registering-using-userpass" title="Direct link to registering-using-userpass">​</a></h3><p>If you want to register using username and password or add a new username+password credentials to an account, perform the same steps as for logging in above but with a new username/password. You will receive a registration token. Continue with user linking/creation described below.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-github-strategy">Using the GitHub strategy<a href="#using-the-github-strategy" class="hash-link" aria-label="Direct link to Using the GitHub strategy" title="Direct link to Using the GitHub strategy">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="oauth-clients">OAuth clients<a href="#oauth-clients" class="hash-link" aria-label="Direct link to OAuth clients" title="Direct link to OAuth clients">​</a></h3><p>For any strategy that requires redirecting (e.g. github) and doesn&#x27;t simply accept credentials posted to the token-endpoint (e.g. userpass), the client-software needs to authenticate against the login API as an OAuth client according to the specification.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>From the <a href="https://www.rfc-editor.org/rfc/rfc6749" target="_blank" rel="noopener noreferrer">OAuth2.0 specification</a>:</p><p>In OAuth, the client requests access to resources controlled by the resource owner and hosted by the resource server, and is issued a different set of credentials than those of the resource owner.
<!-- -->[...]<!-- -->
For example, an end-user (resource owner) can grant a printing service (client) access to her protected photos stored at a photo-sharing service (resource server)</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="list-all-oauth-clients">List all OAuth clients<a href="#list-all-oauth-clients" class="hash-link" aria-label="Direct link to List all OAuth clients" title="Direct link to List all OAuth clients">​</a></h4><p>If you created an OAuth client using the initialization config described above, you can retrieve its id using this request.</p><p>If a valid client which requires no secret is found, its id will be autofilled in the edit OAuth client and run OAuth flow sections.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="edit-existingcreate-new-oauth-client">Edit existing/Create new OAuth Client<a href="#edit-existingcreate-new-oauth-client" class="hash-link" aria-label="Direct link to Edit existing/Create new OAuth Client" title="Direct link to Edit existing/Create new OAuth Client">​</a></h4><p>To successfully run a redirect OAuth flow, the client needs a redirect URL. This is the URL the OAuth code will be sent to for request ing a token.</p><p>To update the existing client (created during initialization) with the debug page used as redirect url:</p><ol><li>List all OAuth clients<ul><li>This will automatically populate the inputs for editing the client with the current values</li></ul></li><li>Set the correct redirect URL<ul><li>To use the debug page as client, add its URL to the redirect urls</li></ul></li><li>Enable the client and disable client secrets (NEVER have an enabled client with no secrets in an production environment)</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-github-strategy-instance">The <code>github</code> strategy instance<a href="#the-github-strategy-instance" class="hash-link" aria-label="Direct link to the-github-strategy-instance" title="Direct link to the-github-strategy-instance">​</a></h3><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>To be able to log in using the github strategy, you need to <a href="https://github.com/settings/applications/new" target="_blank" rel="noopener noreferrer">create a GitHub OAuth app</a>.</p><p>The <code>Authorization callback URL</code> will need to be set to the appropirate URL on the login API. The callback URL needs to have the following format:
<code>http://HOST_OF_YOUR_LOGIN_API:3000/authenticate/oauth/ID_OF_THE_GITHUB_STRATEGY_INSTANCE/callback</code>
Where you need the id of the created github strategy instance. So to be able to retrieve the client id and client secret needed for creation of the instance, prefill this field with the url above where you only replace the <code>HOST_OF_YOUR_LOGIN_API</code> with the appropriate hostname (e.g. localhost).</p><p>You will need the created client id and the client secret while creating an instance of the github strategy.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="show-all-existing-github-strategy-instances">Show all existing github strategy instances<a href="#show-all-existing-github-strategy-instances" class="hash-link" aria-label="Direct link to Show all existing github strategy instances" title="Direct link to Show all existing github strategy instances">​</a></h4><p>If you list all github strategy instances and one or more already exist, the input fields for editing/creating a github strategy instance will be prepopulated with the current values</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-newedit-existing-github-strategy-instance">Create new/Edit existing github strategy instance<a href="#create-newedit-existing-github-strategy-instance" class="hash-link" aria-label="Direct link to Create new/Edit existing github strategy instance" title="Direct link to Create new/Edit existing github strategy instance">​</a></h4><p>Create a new gitub strategy instance or edit an existing one:</p><ol><li><a href="https://github.com/settings/applications/new" target="_blank" rel="noopener noreferrer">Create a GitHub OAuth App</a> (see above)</li><li>Fill in your GitHub-OAuth-App client id and client secret</li><li>Set the flags according to your preferences (Reccomended: All flags enabled)<ul><li>Enable login: Allows users to use this instance to retrieve a full access token to the gropius backend</li><li>Enable self registration: Allows users to create an account <strong>themselves</strong> based on an authentication with this instance. Administrators will always be able to register using an instance</li><li>Enable sync: If users decide to grant sync permission, this strategy will be used to perform the actions the users perform in gropius as that user on GitHub instead of as a dummy user</li><li>Allow implicit register: If a user tries to log in that isn&#x27;t registered, this will automatically start the registration process. Otherwise users need to explicitly choose to register.</li></ul></li><li>Execute the creation/edit</li><li><a href="https://github.com/settings/developers" target="_blank" rel="noopener noreferrer">Update the GitHub OAuth App</a> <code>Authorization callback URL</code><ul><li>Retrieve the id of the created/edited instance from the response of the execution or by listing all existing github strategy instances</li><li>Set the <code>Authorization callback URL</code> to the pattern: <code>http://HOST_OF_YOUR_LOGIN_API:3000/authenticate/oauth/ID_OF_THE_GITHUB_STRATEGY_INSTANCE/callback</code></li><li>Replace <code>HOST_OF_YOUR_LOGIN_API</code> in the pattern with the hostname where you access the login api (e.g. localhost)</li><li>Replace <code>ID_OF_THE_GITHUB_STRATEGY_INSTANCE</code> in the pattern with the id retrieved</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-oauth-redirect-flow">Running the OAuth redirect flow<a href="#running-the-oauth-redirect-flow" class="hash-link" aria-label="Direct link to Running the OAuth redirect flow" title="Direct link to Running the OAuth redirect flow">​</a></h3><p>To run a redirect flow you need the id of an OAuth client and the id of the strategy instance (see above).</p><ol><li>Choose the mode of the flow<ul><li>login: Get access token if already registered and linked to account or register (without sync) if the instance has implicit registration turned on</li><li>register: Register a new authentication (either to create a new user or to link to an existing user). Will return a registration token instead of a full access token. If already registered, this is equivalent to login</li><li>register-sync: Register a new authentication (either to create a new user or to link to an existing user). This will however request sync (repository edit) permissions from the user. If already registered, this will &quot;upgrade&quot; the registration to a registration with sync.</li></ul></li><li>Initiate the flow by redirecting the user to the appropriate authorize URL</li><li>Authorize using the third-party where you are redirected to (e.g. GitHub)</li><li>Finally, the login API will redirect back to the specified redirect-url (see &quot;Edit existing/Create new OAuth Client&quot;)<ul><li>The redirect will contain the &quot;code&quot; in the query parameters needed to retrieve the actual token</li><li>If this is set to the debug page, the input field for the code below &quot;Request an access token using the retrieved code&quot; will automatically be prefilled</li><li>If the OAuth client you used to initiate the flow requires a secret, enter it in the field, otherwise leave it empty</li></ul></li><li>Executing the token request will return an access and a refresh token<ul><li>The token will either have full API access (scope: backend login)</li><li>Or it will be a registration token (scope: login-register). This token will be autofilled in the registration/linking form </li></ul></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="register-newlink-existing-user-with-authentication">Register new/Link existing user with authentication<a href="#register-newlink-existing-user-with-authentication" class="hash-link" aria-label="Direct link to Register new/Link existing user with authentication" title="Direct link to Register new/Link existing user with authentication">​</a></h2><p>The following section describes user registration/linking. This only works if the authentication has not yet been linked to a user.
I.e. the authentication was done using the &quot;register(-link)&quot; modes or using implicit registration, thus a registration token is present for the authentication (token scope: login-register). A already linked authentication can not be re-linked to another user.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-user-concept-of-the-gropius-backend">The user concept of the gropius backend<a href="#the-user-concept-of-the-gropius-backend" class="hash-link" aria-label="Direct link to The user concept of the gropius backend" title="Direct link to The user concept of the gropius backend">​</a></h3><p>This section shows and explains the different entities and their relations that are useful to know when dealing with users within the gropius system. </p><p><em>Note: The following diagram not necessarily represents classes/relations in code 1:1. It is a simplification for showing the concepts</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="register-as-new-user">Register as new user<a href="#register-as-new-user" class="hash-link" aria-label="Direct link to Register as new user" title="Direct link to Register as new user">​</a></h3><p>If the authentication is for a user not yet present (as GropiusUser; it is possible that an IMSUser representing the same user already exists, this is however irrelevant) in the system, a new user needs to be created:</p><ol><li>Enter the registration token retrieved during authentication<ul><li>If e.g. an OAuth flow returns a registration token (insteaf of an access token) the debug page will automatically fill the appropriate field</li></ul></li><li>It is possible to query a for a &quot;data suggestion&quot; for the new user based on the authentication<ul><li>These should be the values the input fields for the user should be prefilled with</li><li>The debug page does this if the data-suggestion is requested</li><li>The data suggestion is based on data collected by the authentication (e.g. username and email from GitHub)</li></ul></li><li>Fill the needed new user fields (either via the data-suggestion or manually)</li><li>Run the user creation</li></ol><p>This will cause the user to be created and the authentication to be linked to the new user. If the authentication is executed again, it will no longer return a registration token but instead a full access token directly.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>It is not needed to run the authentication again after registration to get a full access token. Using the currently active refresh token returned with the registration token and running the token refresh will return a full access token once registered</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-to-existinglogged-in-user">Link to existing/logged in user<a href="#link-to-existinglogged-in-user" class="hash-link" aria-label="Direct link to Link to existing/logged in user" title="Direct link to Link to existing/logged in user">​</a></h3><p>If the user that authenticated is already present (as GropiusUser) and just wants to add a new authentication to the account (or allow for sync) then no new account should be created but instead the authenticaiton should be linked to the existing user.</p><ol><li>Access token<ul><li>Make sure you have an active, valid, full access token (independant of the authenticaiton)</li><li>The token should be for the account to link to or an administrator token</li></ul></li><li>Link to other user (not the one logged in with the above token)<ul><li>If you have an andmin access token you can link a registration to any existing user</li><li>Enter the id of the user to link to in the required field</li></ul></li><li>Perform linking<ul><li>Enter the registration token (autofilled if one is obtained on the debug page)</li><li>Execute self or admin linking</li></ul></li></ol><p>If the linking was successfull, the authentication is now linked and represents the user. Like with user creation, it is possible to exchange the registration token for a full access token (this is however likely not needed as for linking a already valid full access token is required).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linking-of-imsusers-and-gropiususers">Linking of IMSUsers and GropiusUsers<a href="#linking-of-imsusers-and-gropiususers" class="hash-link" aria-label="Direct link to Linking of IMSUsers and GropiusUsers" title="Direct link to Linking of IMSUsers and GropiusUsers">​</a></h3><p><em>Note: This section describes what happens in the background after user linking and is not relevant to using the login API, you can skip it if you want.</em></p><p>After a link between a user and authentication that uses a strategy instance representing an IMS (e.g. a github instance, NOT a userpass instance) has been created, the system matches all IMSUsers on that IMS that represent the user in that authenticaion to that authentication.
In the next step all the matched IMSUsers are linked with the GropiusUser that the authentication has been linked to.
This allows the gropius system to relate actions performed by one person in an IMS (thus by one specific IMSUser) to that persons GropiusUSer (thus their &quot;account&quot; within gropius).
But the relation is then also possible the other way around, allowing the system to find the IMSUser (and potentially an access token) when the person performs an action within Gropius.
This information is then used to populate the IMS synced to with the correct user information (and if a token is present even in the name of that person).</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/gropius-docs/login"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Login Service</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tldr-steps-summary-see-below-for-details" class="table-of-contents__link toc-highlight">Tldr (Steps-Summary; see below for details)</a></li><li><a href="#cloning" class="table-of-contents__link toc-highlight">Cloning</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#access-token-expiration" class="table-of-contents__link toc-highlight">Access token expiration</a></li><li><a href="#initial-user-creation" class="table-of-contents__link toc-highlight">Initial user creation</a></li></ul></li><li><a href="#initial-startup" class="table-of-contents__link toc-highlight">Initial startup</a></li><li><a href="#using-the-login-api" class="table-of-contents__link toc-highlight">Using the login API</a></li><li><a href="#the-debug-page" class="table-of-contents__link toc-highlight">The debug page</a><ul><li><a href="#functionality" class="table-of-contents__link toc-highlight">Functionality</a></li><li><a href="#settings" class="table-of-contents__link toc-highlight">Settings</a></li><li><a href="#custommanual-requests" class="table-of-contents__link toc-highlight">Custom/Manual requests</a></li></ul></li><li><a href="#retrieving-an-access-token-using-the-userpass-strategy" class="table-of-contents__link toc-highlight">Retrieving an access token using the <code>userpass</code> strategy</a><ul><li><a href="#refresh-token" class="table-of-contents__link toc-highlight">Refresh token</a></li><li><a href="#registering-using-userpass" class="table-of-contents__link toc-highlight">Registering using <code>userpass</code></a></li></ul></li><li><a href="#using-the-github-strategy" class="table-of-contents__link toc-highlight">Using the GitHub strategy</a><ul><li><a href="#oauth-clients" class="table-of-contents__link toc-highlight">OAuth clients</a></li><li><a href="#the-github-strategy-instance" class="table-of-contents__link toc-highlight">The <code>github</code> strategy instance</a></li><li><a href="#running-the-oauth-redirect-flow" class="table-of-contents__link toc-highlight">Running the OAuth redirect flow</a></li></ul></li><li><a href="#register-newlink-existing-user-with-authentication" class="table-of-contents__link toc-highlight">Register new/Link existing user with authentication</a><ul><li><a href="#the-user-concept-of-the-gropius-backend" class="table-of-contents__link toc-highlight">The user concept of the gropius backend</a></li><li><a href="#register-as-new-user" class="table-of-contents__link toc-highlight">Register as new user</a></li><li><a href="#link-to-existinglogged-in-user" class="table-of-contents__link toc-highlight">Link to existing/logged in user</a></li><li><a href="#linking-of-imsusers-and-gropiususers" class="table-of-contents__link toc-highlight">Linking of IMSUsers and GropiusUsers</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with Docusaurus.</div></div></div></footer></div>
<script src="/gropius-docs/assets/js/runtime~main.eaca41a1.js"></script>
<script src="/gropius-docs/assets/js/main.109f328f.js"></script>
</body>
</html>